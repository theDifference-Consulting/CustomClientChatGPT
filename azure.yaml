name: ClientAIChatBot
metadata:
  template: sample-app-aoai-chatgpt@0.0.1-beta
services:
  backend:
    project: .
    language: py
    host: appservice
    appSettings:
      AUTH_CLIENT_SECRET: ""
      AUTH_ENABLED: "False"
      AZURE_COSMOSDB_MONGO_VCORE_CONNECTION_STRING: ""
      AZURE_COSMOSDB_MONGO_VCORE_CONTAINER: ""
      AZURE_COSMOSDB_MONGO_VCORE_CONTENT_COLUMNS: ""
      AZURE_COSMOSDB_MONGO_VCORE_DATABASE: ""
      AZURE_COSMOSDB_MONGO_VCORE_FILENAME_COLUMN: ""
      AZURE_COSMOSDB_MONGO_VCORE_INDEX: ""
      AZURE_COSMOSDB_MONGO_VCORE_TITLE_COLUMN: ""
      AZURE_COSMOSDB_MONGO_VCORE_URL_COLUMN: ""
      AZURE_COSMOSDB_MONGO_VCORE_VECTOR_COLUMNS: ""
      AZURE_OPENAI_EMBEDDING_NAME: "embedding"
      AZURE_OPENAI_ENDPOINT: "https://tdgpt.openai.azure.com/"
      AZURE_OPENAI_KEY: ""
      AZURE_OPENAI_MAX_TOKENS: "800"
      AZURE_OPENAI_MODEL: "gates"
      AZURE_OPENAI_MODEL_NAME: "gpt-4o"
      AZURE_OPENAI_RESOURCE: "tdgpt"
      AZURE_OPENAI_STOP_SEQUENCE: ""
      AZURE_OPENAI_SYSTEM_MESSAGE: "You are a customer support agent specializing in the GAVI Zero-Dose initiative. Your primary goal is to assist users with queries specifically related to the Zero-Dose initiative. You are friendly, concise, and only provide factual answers. There are 180 submitted abstracts you can pull from, and the 'Accepted Abstracts.txt' file is a comprehensive index of these abstracts. Each entry in the index corresponds to a PDF file that offers an individual view of one row at a time. You must always check the 'Accepted Abstracts.txt' file first before consulting any of the PDFs to ensure you provide accurate and relevant information."
      AZURE_OPENAI_TEMPERATURE: "0"
      AZURE_OPENAI_TOP_P: "1"
      AZURE_SEARCH_CONTENT_COLUMNS: ""
      AZURE_SEARCH_ENABLE_IN_DOMAIN: "true"
      AZURE_SEARCH_FILENAME_COLUMN: ""
      AZURE_SEARCH_INDEX: "zdsearch"
      AZURE_SEARCH_KEY: ""
      AZURE_SEARCH_PERMITTED_GROUPS_COLUMN: ""
      AZURE_SEARCH_QUERY_TYPE: "vectorSimpleHybrid"
      AZURE_SEARCH_SEMANTIC_SEARCH_CONFIG: "true"
      AZURE_SEARCH_SERVICE: "zero-dose"
      AZURE_SEARCH_STRICTNESS: "3"
      AZURE_SEARCH_TITLE_COLUMN: ""
      AZURE_SEARCH_TOP_K: "5"
      AZURE_SEARCH_URL_COLUMN: ""
      AZURE_SEARCH_USE_SEMANTIC_SEARCH: "true"
      AZURE_SEARCH_VECTOR_COLUMNS: ""
      DATASOURCE_TYPE: "AzureCognitiveSearch"
      SCM_DO_BUILD_DURING_DEPLOYMENT: "true"
      UI_CHAT_TITLE: "Start Chatting"
      UI_SHOW_CHAT_HISTORY_BUTTON: "false"
      UI_SHOW_SHARE_BUTTON: "false"
      UI_TITLE: "Zero-Dose Learning Week Abstract Database"
    hooks:
      prepackage:
        windows:
          shell: pwsh
          run:  cd ./frontend;npm install;npm run build
          interactive: true
          continueOnError: false
        posix:
          shell: sh
          run:  cd ./frontend;npm install;npm run build
          interactive: true
          continueOnError: false
hooks:
    preprovision:
      windows:
        shell: pwsh
        run: ./scripts/auth_init.ps1
        interactive: true
        continueOnError: false
      posix:
        shell: sh
        run: ./scripts/auth_init.sh
        interactive: true
        continueOnError: false
    postprovision:
      windows:
        shell: pwsh
        run: ./scripts/auth_update.ps1;./scripts/prepdocs.ps1;
        interactive: true
        continueOnError: false
      posix:
        shell: sh
        run: ./scripts/auth_update.sh;./scripts/prepdocs.sh;
        interactive: true
        continueOnError: false